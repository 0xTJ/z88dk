#     ZZZZZZZZZZZZZZZZZZZZ    8888888888888       00000000000
#   ZZZZZZZZZZZZZZZZZZZZ    88888888888888888    0000000000000
#                ZZZZZ      888           888  0000         0000
#              ZZZZZ        88888888888888888  0000         0000
#            ZZZZZ            8888888888888    0000         0000       AAAAAA         SSSSSSSSSSS   MMMM       MMMM
#          ZZZZZ            88888888888888888  0000         0000      AAAAAAAA      SSSS            MMMMMM   MMMMMM
#        ZZZZZ              8888         8888  0000         0000     AAAA  AAAA     SSSSSSSSSSS     MMMMMMMMMMMMMMM
#      ZZZZZ                8888         8888  0000         0000    AAAAAAAAAAAA      SSSSSSSSSSS   MMMM MMMMM MMMM
#    ZZZZZZZZZZZZZZZZZZZZZ  88888888888888888    0000000000000     AAAA      AAAA           SSSSS   MMMM       MMMM
#  ZZZZZZZZZZZZZZZZZZZZZ      8888888888888       00000000000     AAAA        AAAA  SSSSSSSSSSS     MMMM       MMMM
#
# Copyright (C) Gunther Strube, InterLogic 1993-99
# Copyright (C) Paulo Custodio, 2011

# $Header: /home/dom/z88dk-git/cvs/z88dk/src/z80asm/Makefile,v 1.23 2011-09-29 21:27:16 pauloscustodio Exp $
# $Log: Makefile,v $
# Revision 1.23  2011-09-29 21:27:16  pauloscustodio
# Updated depend
#
# Revision 1.22  2011/08/21 20:18:33  pauloscustodio
# Dependencies updated
#
# Revision 1.21  2011/08/19 15:53:58  pauloscustodio
# BUG_0010 : heap corruption when reaching MAXCODESIZE
# - test for overflow of MAXCODESIZE is done before each instruction at parseline(); if only one byte is available in codearea, and a 2 byte instruction is assembled, the heap is corrupted before the exception is raised.
# - Factored all the codearea-accessing code into a new module, checking for MAXCODESIZE on every write.
#
# Revision 1.20  2011/08/18 23:16:10  pauloscustodio
# Dependencies
#
# Revision 1.19  2011/08/18 21:45:17  pauloscustodio
# new object file.o
#
# Revision 1.18  2011/08/05 19:30:57  pauloscustodio
# CH_0004 : Exception mechanism to handle fatal errors
#
# Revision 1.17  2011/07/18 00:48:25  pauloscustodio
# Initialize MS Visual Studio DEBUG build to show memory leaks on exit
#
# Revision 1.16  2011/07/14 01:32:08  pauloscustodio
#     - Unified "Integer out of range" and "Out of range" errors; they are the same error.
#     - Unified ReportIOError as ReportError(ERR_FILE_OPEN)
#     CH_0003 : Error messages should be more informative
#         - Added printf-args to error messages, added "Error:" prefix.
#     BUG_0006 : sub-expressions with unbalanced parentheses type accepted, e.g. (2+3] or [2+3)
#         - Raise ERR_UNBALANCED_PAREN instead
#
# Revision 1.15  2011/07/12 22:47:59  pauloscustodio
# - Moved all error variables and error reporting code to a separate module errors.c,
#   replaced all extern declarations of these variables by include errors.h,
#   created symbolic constants for error codes.
# - Added test scripts for error messages.
#
# Revision 1.14  2011/07/11 15:54:37  pauloscustodio
# new module options.o
#
# Revision 1.13  2011/07/09 18:25:35  pauloscustodio
# Log keyword in checkin comment was expanded inside Log expansion... recursive
# Added Z80asm banner to all source files
#
# Revision 1.12  2011/07/09 17:36:09  pauloscustodio
# Copied cvs log into Log history
#
# Revision 1.11  2011/07/09 01:46:00  pauloscustodio
# Added Log keyword
# 
# Revision 1.10  2011/07/09 01:12:31  pauloscustodio
# Added test and depend targets
# 
# Revision 1.9  2011/06/26 16:07:29  dom
# Add some support for using binutils
# 
# Revision 1.8  2009/07/19 18:54:52  dom
# introduce exesuffix so that we can use mingw to produce an automagic build
# 
# Revision 1.7  2002/12/09 18:49:46  dom
# simplified the makefiles somewhat, allow cross building for Amiga on linux
# 
# Revision 1.6  2002/10/22 19:15:27  dom
# Makefile changes to use $(RM) instead of rm
# 
# Revision 1.5  2002/07/15 17:45:46  dom
# updates to ensure that the thing can install in /usr/local/bin /usr/local/z88dk on unix systems
# 
# Revision 1.4  2002/01/20 23:21:14  dom
# bumped version number and added prototype (from Dennis)
# 
# Revision 1.3  2001/02/28 17:59:22  dom
# Added UNDEFINE for undefining symbols, bumped version to 1.0.18
# 
# Revision 1.2  2001/01/23 10:00:08  dom
# Changes by x1cygnus:
# 
# just added a harcoded macro Invoke, similar to callpkg except that the
# instruction 'Invoke' resolves to a call by default (ti83) and to a RST if
# the parameter -plus is specified on the command line.
# 
# Changes by dom:
# Added in a rudimentary default directory set up (Defined at compile time)
# a bit kludgy and not very nice!
# 
# Revision 1.1  2000/07/04 15:33:30  dom
# branches:  1.1.1;
# Initial revision
# 
# Revision 1.1.1.1  2000/07/04 15:33:30  dom
# First import of z88dk into the sourceforge system <gulp>
#

OBJS = 	asmdrctv.o 	\
	avltree.o	\
	exprprsr.o	\
	hist.o		\
	ldinstr.o	\
	modlink.o	\
	prsident.o	\
	prsline.o	\
	symbols.o	\
	z80asm.o	\
	z80instr.o	\
	z80pass.o	\
	options.o	\
	errors.o	\
	memalloc.o	\
	except.o	\
	file.o		\
	codearea.o	\
	objfile.o

all: z80asm$(EXESUFFIX)


z80asm$(EXESUFFIX): $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) -o z80asm$(EXESUFFIX)  $(OBJS)


install:
	install  z80asm$(EXESUFFIX) $(PREFIX)/bin/


clean :
	$(RM) *.o *~ *.bak core z80asm$(EXESUFFIX) test.* test2.*


# test
test : z80asm$(EXESUFFIX)
	perl -S prove t/*.t


# Dependencies
depend:
	makedepend -Y -- $(CFLAGS) -- $(OBJS:.o=.c)

# DO NOT DELETE

asmdrctv.o: memalloc.h except.h e4c.h config.h ../config.h options.h symbol.h
asmdrctv.o: avltree.h z80asm.h errors.h file.h codearea.h
avltree.o: memalloc.h except.h e4c.h avltree.h
exprprsr.o: memalloc.h except.h e4c.h config.h ../config.h symbol.h avltree.h
exprprsr.o: options.h errors.h file.h codearea.h
hist.o: memalloc.h except.h e4c.h hist.h
ldinstr.o: memalloc.h except.h e4c.h config.h ../config.h z80asm.h avltree.h
ldinstr.o: symbol.h errors.h codearea.h
modlink.o: memalloc.h except.h e4c.h config.h ../config.h options.h symbol.h
modlink.o: avltree.h z80asm.h errors.h file.h codearea.h
prsident.o: memalloc.h except.h e4c.h config.h ../config.h z80asm.h avltree.h
prsident.o: symbol.h options.h errors.h codearea.h
prsline.o: memalloc.h except.h e4c.h config.h ../config.h z80asm.h avltree.h
prsline.o: symbol.h options.h errors.h
symbols.o: memalloc.h except.h e4c.h config.h ../config.h symbol.h avltree.h
symbols.o: symbols.h options.h errors.h
z80asm.o: memalloc.h except.h e4c.h config.h ../config.h symbol.h avltree.h
z80asm.o: z80asm.h hist.h options.h errors.h file.h codearea.h
z80instr.o: memalloc.h except.h e4c.h config.h ../config.h z80asm.h avltree.h
z80instr.o: symbol.h options.h errors.h codearea.h
z80pass.o: memalloc.h except.h e4c.h config.h ../config.h symbol.h avltree.h
z80pass.o: hist.h options.h z80asm.h errors.h file.h codearea.h
options.o: memalloc.h except.h e4c.h z80asm.h config.h ../config.h avltree.h
options.o: options.h symbol.h symbols.h errors.h
errors.o: memalloc.h except.h e4c.h errors.h symbol.h avltree.h options.h
errors.o: z80asm.h config.h ../config.h
memalloc.o: memalloc.h except.h e4c.h
except.o: except.h memalloc.h e4c.h e4c.c
file.o: file.h memalloc.h except.h e4c.h config.h ../config.h
codearea.o: codearea.h memalloc.h except.h e4c.h config.h ../config.h
codearea.o: errors.h symbol.h avltree.h z80asm.h file.h
objfile.o: objfile.h memalloc.h except.h e4c.h
