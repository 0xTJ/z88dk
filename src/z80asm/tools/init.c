/* generated by {{ prog }} {{ args.join(' ') }} */

/* includes */
#include "memalloc.h"   			/* before any other include */

#include "init.h"
#undef main							/* define main only in user code */

/* declare functions */
extern int 	user_main(int argc, char *argv[]);
static void init();

/* initialize all modules */
static void init()
{
{{ FOREACH i IN init_module }}
  {{ IF i.type == 'init' }}
	{{ i.func }}();
  {{ ELSE }}
	xatexit( {{ i.func }} );
  {{ END }}
{{ END }}
}

/* new main function to init and call user main */
int main(int argc, char *argv[])
{
    init();
    return user_main(argc, argv);
}
